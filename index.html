<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Happy Birthday Ailly üéâ</title>

<link id="favicon" rel="icon" type="image/png" href="icon-cake.png">

<style>
  body{
    margin:0; min-height:100vh;
    display:flex; align-items:center; justify-content:center;
    background:linear-gradient(180deg,#2b0a3d,#090014);
    font-family:Arial,sans-serif; color:white;
    padding:16px;
  }
  .card{
    width:360px; max-width:92vw;
    padding:22px; border-radius:20px;
    background:rgba(255,255,255,.08);
    text-align:center; position:relative;
    box-shadow:0 0 40px rgba(255,105,210,.4);
  }
  h1{color:#ff66d9;text-shadow:0 0 14px #ff66d9;margin:0 0 8px}
  p{margin:0 0 12px;opacity:.9}
  .btn{
    width:100%; padding:14px; margin-top:12px;
    border-radius:30px; font-size:16px; font-weight:700;
    border:none; cursor:pointer;
    -webkit-tap-highlight-color: transparent;
  }
  #realBtn{background:#ff66d9;color:#120010}
  #prankBtn{
    background:black;color:#ff66d9;border:2px solid #ff66d9;
    position:absolute; bottom:14px; left:50%;
    transform:translateX(-50%); width:calc(100% - 44px);
  }
  .spacer{height:70px}

  /* MODAL */
  .modal{
    position:fixed; inset:0; display:none;
    background:rgba(0,0,0,.82);
    align-items:center; justify-content:center;
    padding:16px;
    z-index:9999;
  }
  .modal.show{display:flex}
  .box{
    background:#140a1e;
    padding:18px;
    border-radius:16px;
    width:min(560px, 92vw);
    max-height:90vh;
    position:relative;
    overflow:auto;
    box-shadow:0 0 40px rgba(255,102,217,.22);
    border:1px solid rgba(255,102,217,.25);
  }

  /* FIXED CLOSE BUTTON (ON TOP + CLICKABLE) */
  .close{
    position:absolute;
    top:10px;
    right:10px;
    z-index:99999;
    background:black;
    color:#ff66d9;
    border:2px solid #ff66d9;
    border-radius:50%;
    width:42px;
    height:42px;
    font-size:20px;
    font-weight:900;
    cursor:pointer;
    display:flex;
    align-items:center;
    justify-content:center;
  }

  /* CAKE */
  .cake{width:220px;height:160px;position:relative;margin:10px auto 0}
  .layer{position:absolute;left:50%;transform:translateX(-50%);
    background:#ff66d9;border-radius:20px}
  .layer.bottom{bottom:0;width:220px;height:90px}
  .layer.top{bottom:80px;width:160px;height:60px}
  .candle{position:absolute;left:50%;bottom:135px;
    transform:translateX(-50%);width:14px;height:40px;background:white;border-radius:6px}
  .flame{
    position:absolute;top:-22px;left:50%;transform:translateX(-50%);
    width:18px;height:24px;border-radius:50%;
    background:radial-gradient(circle,#fff,#ffb347,#ff6699);
    animation:flicker .2s infinite alternate;
    cursor:pointer;
  }
  .flame.off{opacity:0;animation:none;pointer-events:none}
  @keyframes flicker{
    from{transform:translateX(-50%) scale(1)}
    to{transform:translateX(-50%) scale(1.1)}
  }

  /* GHOST */
  .ghostImg{
    width:min(520px, 86vw);
    max-height:70vh;
    border-radius:14px;
    display:block;
    margin:10px auto 0;
    box-shadow:0 0 40px rgba(0,0,0,.4);
  }

  #wish{
    text-align:center;
    font-weight:800;
    color:#ff66d9;
    text-shadow:0 0 14px rgba(255,102,217,.55);
    margin:12px 0 0;
  }
  .hint{
    font-size:12px;
    opacity:.75;
    margin-top:6px;
  }
</style>
</head>

<body>
  <div class="card">
    <h1>üéâ Happy Birthday Ailly üéâ</h1>
    <p>Happy bithday to you from n0scape</p>

    <button class="btn" id="realBtn">cake</button>

    <div class="spacer"></div>

    <button class="btn" id="prankBtn">Message for you</button>
  </div>

  <div class="modal" id="modal">
    <div class="box" role="dialog" aria-modal="true">
      <!-- IMPORTANT: id is closeBtn (NOT close) -->
      <button class="close" id="closeBtn" type="button" aria-label="Close">‚úñ</button>

      <div id="giftView" style="display:none">
        <div class="cake">
          <div class="layer top"></div>
          <div class="candle"><div class="flame" id="flame" title="Tap to blow the candle"></div></div>
          <div class="layer bottom"></div>
        </div>
        <div class="hint">Tap the flame to turn it off üïØÔ∏è‚ú®</div>
        <p id="wish"></p>
      </div>

      <div id="ghostView" style="display:none">
        <img src="ghost.png" class="ghostImg" alt="Ghost">
        <div class="hint" style="text-align:center;">üëª PRANK MODE‚Ä¶ close to stop the sound.</div>
      </div>
    </div>
  </div>

<script>
  /* ===== UI ELEMENTS ===== */
  const favicon = document.getElementById("favicon");
  const modal = document.getElementById("modal");
  const giftView = document.getElementById("giftView");
  const ghostView = document.getElementById("ghostView");
  const flame = document.getElementById("flame");
  const wish = document.getElementById("wish");
  const closeBtn = document.getElementById("closeBtn");

  const realBtn = document.getElementById("realBtn");
  const prankBtn = document.getElementById("prankBtn");

  /* ===== FAVICON ===== */
  function setIcon(file){
    favicon.href = file + "?v=" + Date.now();
  }

  /* ===== AUDIO ENGINE (NO FILES) ===== */
  let ctx;
  function initAudio(){
    if(!ctx) ctx = new (window.AudioContext || window.webkitAudioContext)();
  }

  // üé∂ Singing birthday candle
  function singBirthday(){
    initAudio();
    const notes = [392,392,440,392,523,494]; // short happy melody
    notes.forEach((f,i)=>{
      const o = ctx.createOscillator();
      const g = ctx.createGain();
      o.type="sine";
      o.frequency.value=f;
      o.connect(g); g.connect(ctx.destination);
      g.gain.setValueAtTime(0.12, ctx.currentTime + i*0.30);
      g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + i*0.30 + 0.25);
      o.start(ctx.currentTime + i*0.30);
      o.stop(ctx.currentTime + i*0.30 + 0.30);
    });
  }

  // ‚ú® Candle off sparkle
  function sparkle(){
    initAudio();
    const o = ctx.createOscillator();
    const g = ctx.createGain();
    o.type="triangle";
    o.frequency.setValueAtTime(1200, ctx.currentTime);
    o.frequency.exponentialRampToValueAtTime(300, ctx.currentTime + 0.35);
    o.connect(g); g.connect(ctx.destination);
    g.gain.setValueAtTime(0.18, ctx.currentTime);
    g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + 0.4);
    o.start();
    o.stop(ctx.currentTime + 0.42);
  }

  // üëª Ghost sound: heartbeat + wind/whisper (loop)
  let heartbeatTimer = null;
  let windSource = null;

  function startGhostSound(){
    initAudio();
    stopGhostSound();

    // üíì Heartbeat pulse
    heartbeatTimer = setInterval(()=>{
      const o = ctx.createOscillator();
      const g = ctx.createGain();
      o.type="sine";
      o.frequency.value=60;
      o.connect(g); g.connect(ctx.destination);
      g.gain.setValueAtTime(0.14, ctx.currentTime);
      g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + 0.12);
      o.start();
      o.stop(ctx.currentTime + 0.12);
    }, 700);

    // üå¨Ô∏è Wind/whisper noise
    const buffer = ctx.createBuffer(1, ctx.sampleRate * 2, ctx.sampleRate);
    const data = buffer.getChannelData(0);
    for(let i=0;i<data.length;i++){
      // soft noise
      data[i] = (Math.random()*2 - 1) * 0.55;
    }
    windSource = ctx.createBufferSource();
    windSource.buffer = buffer;
    windSource.loop = true;

    const bandpass = ctx.createBiquadFilter();
    bandpass.type = "bandpass";
    bandpass.frequency.value = 380; // whisper-ish

    const g = ctx.createGain();
    g.gain.value = 0.05; // safe level

    windSource.connect(bandpass);
    bandpass.connect(g);
    g.connect(ctx.destination);
    windSource.start();
  }

  function stopGhostSound(){
    if(heartbeatTimer){
      clearInterval(heartbeatTimer);
      heartbeatTimer = null;
    }
    if(windSource){
      try{ windSource.stop(); }catch(e){}
      windSource = null;
    }
  }

  /* ===== MODAL OPEN/CLOSE ===== */
  function openGift(){
    setIcon("icon-love.png");
    modal.classList.add("show");
    giftView.style.display="block";
    ghostView.style.display="none";
    singBirthday();
  }

  function openGhost(){
    setIcon("icon-prank.png");
    modal.classList.add("show");
    ghostView.style.display="block";
    giftView.style.display="none";
    startGhostSound();
  }

  function closeModal(){
    modal.classList.remove("show");
    stopGhostSound();
    flame.classList.remove("off");
    wish.textContent = "";
    setIcon("icon-cake.png");
  }

  /* ===== EVENTS ===== */
  realBtn.addEventListener("click", openGift);

  prankBtn.addEventListener("click", openGhost);

  // Candle off
  flame.addEventListener("click", ()=>{
    flame.classList.add("off");
    sparkle();
    wish.innerHTML = "üéÇ Happy Birthday Ailly üíñ<br>Wish come true ‚ú®";
  });

  // Close button FIXED
  closeBtn.addEventListener("click", closeModal);

  // Tap outside closes modal
  modal.addEventListener("click", (e)=>{
    if(e.target === modal) closeModal();
  });

  // ESC closes modal (computer)
  document.addEventListener("keydown", (e)=>{
    if(e.key === "Escape") closeModal();
  });

  // default icon
  setIcon("icon-cake.png");
</script>
</body>
</html>
